
<script language="JavaScript"
        type="text/javascript"><!--

var Start = {};

Start.selection = function(name, index, choice)
{
  $(name + '_' + index).checked = true; 
  Start.enable_start_if_all_selected();
  
  if (name == 'kata')
  {     
  	 $('kata_info').value = $('kata[' + choice + ']').value;
  }
  if (name == 'avatar')
  {
  	$('avatar_choice').innerHTML = choice;
  }
}

Start.enable_start_if_all_selected = function()
{
  $('start_button').disabled = 
       !Start.selected('avatar')
    || !Start.selected('filesets[kata]')
    || !Start.selected('filesets[language]');
}

Start.selected = function(name)
{
  radio = document.getElementsByName(name); 
  for (at = 0; at != radio.length; at++)
    if (radio[at].checked)
      return true;
  return false;
}

document.observe('dom:loaded', function() 
{
  Start.enable_start_if_all_selected();
});

//--></script>

<form name="avatarIndex" 
      action="/kata/view">

<noscript>
  &nbsp;
  <h2><b>You must enable JavaScript.</b></h2>
  &nbsp;
</noscript>

<input type="hidden"
       name="dojo" 
       id="dojo" 
       value="<%=h @dojo.name-%>" />

<h1><b>CyberDojo: <%= @dojo.name -%></b></h1>

<table class="panel" >
  <tr><th><span class="choose_title">Avatar? <span id="avatar_choice"></span></span></th></tr>
  <tr>    
    <td valign="top">
      <% chunk_size = 2 -%>
      <% chunks = chunk_array(@avatars.sort, chunk_size) -%>
      <table>
        <% chunks.each_with_index do |chunk,outer| -%>
        <tr>
        <% chunk.each_with_index do |avatar,inner| -%>
           <% index = inner*chunk_size + outer -%>
           <td onclick='Start.selection("avatar", "<%=index-%>", "<%=avatar.humanize-%>");'>
             <input id="avatar_<%=index-%>"
                    type="radio"
                    name="avatar"
                    value="<%=avatar.downcase-%>" />
               <img alt="<%=avatar-%>" 
                    width='50'
                    height='50'
                    src="/images/avatars/<%=avatar.downcase-%>.jpg"
                    title="<%=avatar.humanize-%>" />
           </td>
        <% end -%>
        </tr>
      <% end -%>
      </table>    
    </td>
  </tr>
</table>


<% name = 'kata' -%>
<table>
<tr>
<td valign="top">
<table class="panel">
<tr>
<td>
   <textarea name="kata_info" 
             id="kata_info"
             cols="62" 
             rows="28">
   </textarea>
</td>
<td valign="top">
   <span class="choose_title"><%=name.capitalize-%>?</span>
   <% FileSet.new(name).choices.each_with_index do |choice,index| -%>
     <div onclick='Start.selection("<%=name-%>", "<%=index-%>", "<%=choice-%>");'>
       <input id="<%=name-%>_<%=index-%>" 
              type="radio" 
              name="filesets[<%=name-%>]" 
              value="<%=choice-%>" />
       <label><%= choice -%></label>
     </div>    
   <% end -%>    
</td>
</tr>
</table>
</td>

<td valign="top">
<% name = 'language' -%>
<table class="panel">
<tr>
<td>
    <span class="choose_title"><%=name.capitalize-%>?</span>
    <% FileSet.new(name).choices.each_with_index do |choice,index| -%>
      <div onclick='Start.selection("<%=name-%>", "<%=index-%>", "<%=choice-%>");'>
        <input id="<%=name-%>_<%=index-%>" 
               type="radio" 
               name="filesets[<%=name-%>]" 
               value="<%=choice-%>" />
        <label><%= choice -%></label>
      </div>    
    <% end -%>    
</td>
</tr>
</table>
</td>

<td valign="top">
<input id="start_button" 
       type="submit" 
       value="Start" 
       name="start" />
</td>
</tr>
</table>

</form>

<% name = 'kata' -%>
<% FileSet.new(name).choices.each_with_index do |choice,index| -%>
   <textarea style="display:none;" 
             name="kata[<%=choice-%>]"
             id="kata[<%=choice-%>]"><%=h @kata_info[choice] -%></textarea>
<% end -%>      


