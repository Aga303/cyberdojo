
<script language="javascript" 
        type="text/javascript">

var current_filename = false;
var run_tests_output_loaded = false;

function saveCurrentFile()
{
  // current_filename is initially null on dom:loaded
  // TODO: could it be loaded directly into the editor by rails at start?
  if (current_filename && !run_tests_output_loaded)
  {
    fileContent(current_filename).setAttribute('value', $('editor').value);
    fileCaretPos(current_filename).setAttribute('value', getLiveCaretPos());
  }
}

function loadFile(filename)
{
  if (current_filename)
  {
    // output doesn't have its own file yet...
    $('radio_' + current_filename).parentNode.setAttribute('style', 'font-weight:normal'); 
  } 

  saveCurrentFile();

  var pos = fileCaretPos(filename).getAttribute('value');
  $('editor').readOnly = false;
  $('editor').value = fileContent(filename).getAttribute('value');

  setLiveCaretPos(pos);

  current_filename = filename;
  run_tests_output_loaded = false;
  selectFileInFileList(filename);

  if (filename == 'kata.sh')
  {
    $('file_op[rename]').setAttribute('disabled', 'true'); 
    $('file_op[delete]').setAttribute('disabled', 'true'); 
    //$('file_op[rename]').disabled = true;
    //$('file_op[delete]').disabled = true;
  }
  else
  {
    $('file_op[rename]').setAttribute('disabled', 'false'); 
    $('file_op[delete]').setAttribute('disabled', 'false'); 
  }
}

function selectFileInFileList(filename)
{
  $('radio_' + filename).checked = true;
  $('radio_' + filename).parentNode.setAttribute('style', 'font-weight:normal');
}

function fileContent(filename)
{
  return $("file_content['" + filename + "']");
}

function fileCaretPos(filename)
{
  return $("file_caret_pos['" + filename + "']");
}

</script>

