
<script language="javascript" type="text/javascript">

editAreaLoader.init(
  {
     id: "tabbed_files"	
    ,allow_toggle: false
    ,is_editable: <%=@editable-%>
    ,language: "en"
    ,start_highlight: true
    ,syntax: "<%=@manifest[:language]-%>"	
    ,toolbar: "search, go_to_line, undo, redo, select_font, reset_highlight, help"
    ,is_multi_files: true
    ,EA_load_callback: "editAreaLoaded"
    ,EA_file_close_callback: "editAreaFileClose"
    ,show_line_colors: true
    ,font_size: 14
    ,replace_tab_by_spaces: 4
    }
);

function editAreaLoaded(id)
{
  <% @manifest[:visible_files].each do |filename,info| -%>
     <% if info.include? :preloaded and info[:preloaded] -%>
       editAreaTabbedLoad("<%=filename-%>");
     <%- end -%>
  <% end -%>
}

var closing_old_run_tests_output = false

function editAreaFileClose(closing)
{
  var id = closing['id']
  if (!closing_old_run_tests_output)
  {
    $(id).value = editAreaLoader.getFile('tabbed_files', id).text;
  }
  return true; 
}

function editAreaTabbedLoad(name)
{
  editAreaLoader.openFile(
    'tabbed_files',
    { id: name, text: $(name).value, title: name });
}

function preRunTests()
{
   Element.show('run_tests_spinner');

   // Move contents of editArea tabs still open into hidden textareas.
   // Necessary because only individual textareas have unique
   // id's which rails can retrieve via params[id]
   var names = editAreaLoader.getAllFiles('tabbed_files');
   for(var name in names)
   { 
     var text = editAreaLoader.getFile('tabbed_files', name).text;      
     $(name).value = text
   }; 
}

function postRunTests()
{
   // Replacing the contents of the run_tests_outcome tab in-place
   // would work but closing and then reopening makes sure
   // that the run_tests_output tab becomes the topmost editor tab.

   closing_old_run_tests_output = true;
   editAreaLoader.closeFile('tabbed_files', 'run_tests_output');
   closing_old_run_tests_output = false;
   editAreaTabbedLoad('run_tests_output');
   Element.hide('run_tests_spinner');
}

</script>

