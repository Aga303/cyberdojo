
<script language="javascript" type="text/javascript">

function editAreaLoaded(id)
{
  <% @manifest[:visible_files].each do |filename,info| -%>
     <% if info.include? :preloaded and info[:preloaded] -%>
       editAreaTabbedLoad("<%=filename-%>");
     <%- end -%>
  <% end -%>
}

var current_file_name = false

function saveCurrentFile()
{
  if (current_file_name) {
    $(current_file_name).value = $('editor').value;
  }
}

function loadFile(name)
{
  saveCurrentFile();
  $('editor').value = $(name).value;
  current_file_name = name;
  document.getElementById('radio_' + name).checked = true;
}

function preRunTests()
{
  saveCurrentFile();
  Element.show('run_tests_spinner');
}

function postRunTests()
{
   Element.hide('run_tests_spinner');
}

function predict(prediction)
{
   $('run_tests_prediction').value = prediction;
}

function newFile()
{
  var filename = $('new-filename').value;
  filename = filename.split(' ').join('');
  if (filename=="") return;

  // Create new hidden textarea to save to before submitting.
  var ta = document.createElement("textarea");
  ta.setAttribute('id', filename);
  ta.setAttribute('name', filename);
  $('visible_files_container').appendChild(ta);

  // Make the new filename visible in the file-manager list
  var mle = document.createElement("div");
  mle.setAttribute('id', filename + "-button");
  mle.setAttribute('class', 'fake-button box');
  mle.onclick = new Function("loadFile('" + filename + "')");
  mle.appendChild(document.createTextNode(filename));
  $('filename-button-list').appendChild(mle);

  // make its name available to rails
  var current = $('visible_filenames_container').value;
  current += filename;
  current += ";";
  $('visible_filenames_container').value = current;

  // Blank out the new-filename text input
  $('new-filename').value = '';

  loadFile(filename);
}
</script>

