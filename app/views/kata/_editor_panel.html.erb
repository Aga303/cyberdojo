

<!-- This tabbed_files_border id used by run_tests.js.rjs to colour -->
<!-- the tabbed_files editArea border red or green as appropriate.  -->
<table cellpadding="0" cellpadding="0">
  <tr valign="top">
    <td class="file-manager panel">

      <table>
        <tr>
          <td>
           <div id="shown_increment_number">
             <span class="increment-box" title="current increment"-%>
               <%= @shown_increment_number -%>
             </span>
           </div>
          </td>
          <td>
            <% if (run_tests) -%>
              <%= submit_tag 'run-tests' -%>
            <% end -%>
          </td>
        </tr>
      </table>

      <%= avatar_image(@avatar) {|f| f} -%>
      <%= avatar_image(@avatar) {|f| f} -%>
    
      <table>       
		<% @manifest[:visible_files].sort.each do |filename,file| -%>
		  <tr>
            <td>
			  <div class="buttonista"
                   onclick='editAreaTabbedLoad("<%=filename-%>")'
                   title="load <%= filename -%>">
                &nbsp;<%= filename -%>&nbsp;
              </div>
		    </td>
          </tr>
		<% end -%>
	  </table>

    </td>
    <td>
      <!-- EditArea turns this textarea into a tabbed edtitor. Each -->
      <!-- visible file has a tab in this editor. Javascript copies -->
      <!-- the contents of each individual hidden textarea (below)  -->
      <!-- into this tabbed editor. -->
      <table cellpadding="7" 
             id="tabbed_files_border" 
             class="<%=@outcome-%>">
       <tr><td>
        <textarea id="tabbed_files" 
                  name="tabbed_files" 
                  cols="125" 
                  rows="50">
        </textarea>
       </td></tr>
      </table>
    </td>
  </tr>
</table>


<div class="hidden">

  <div id="manifest.rb_div">
      <textarea id="manifest.rb_div" 
                name="manifest.rb_div"><%= h @manifest.inspect -%></textarea>
  </div>

  <!-- When run-tests is clicked the javascript preRunTests() function copies  -->
  <!-- the contents of each editArea tab back to its hidden textarea (below)   -->
  <!-- before submitting the form. On the server rails grabs the file contents -->
  <!-- from these hidden textareas and not from the tabbed_files editArea.     -->
  <% @manifest[:visible_files].each do |filename,file| -%>
    <!-- This outer div is needed for run_tests_outcome from run_tests.js.rjs -->
    <div id="<%=filename-%>_div">
      <textarea id="<%=filename-%>" 
                name="<%=filename-%>"><%= h file[:content] -%></textarea> 
                <!-- when I load from the manifest I can drop the content here. -->
    </div>
  <% end -%>

</div>

