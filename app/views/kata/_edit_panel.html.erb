
<table cellpadding="0">
  <tr valign="top">
    <td>
    
      <div class="panel">
        <span class="small_title">
          <%= link_to "#{@dojo.name}", 
               { :controller => :dojo, :action => :dashboard, :dojo_name => "#{@dojo.name}" }, 
               { :class => "title", :target => "_blank" } -%>
        </span>            
        <span class="small_title"><%= @kata.name -%></span>
        <span class="small_title"><%= @kata.language -%></span>
      </div>
      
      <div class="panel">
        <%= render :partial => 'fileops' -%>
        <%= render :partial => 'filenames' -%>
      </div>
      
    </td>
    <td>
      <%= render :partial => 'editor' -%>
    </td>
    <td rowspan=2>

      <div class="panel" id="message_panel">
        
        <% post_message_options = {
          :url => { :controller => 'kata',
                    :action => 'post_message',
                    :dojo_name => @dojo.name,
                    :avatar => @avatar.name
                  },
          :with => "{ message: Field.getValue('message_text')}"
        } -%>
        
        <table>
          <tr>
            <td>
               <%= avatar_image(@avatar.name, 45) -%>
            </td>
          
            <td>
             <textarea cols=20" rows="1" name="message_text" id="message_text"></textarea>
            </td>
                       
            <td>
              <%= tag("input", 
                { :type => "button",
                  :class => "button",
                  :onclick => "#{remote_function(post_message_options)};$j('#message_text').val('');",
                  :name => "post_message",
                  :value => "Post",            
                }) -%>
              </td>
            </tr>
          </table>
        
        <%= render :partial => 'messages' -%>
        
      </div>

    </td>
  </tr>
  <tr valign="top">
    <td>
      <table class="panel">      
        <tr>
          <td>
            <%= render :partial => 'run_tests' -%>
          </td>
        </tr>
        <tr>
          <td>
            <%= render :partial => 'increments' -%>
          </td>
         </tr>
       </table>
    </td>
    <td>
      <%= render :partial => 'output' -%>
    </td>
  </tr>
</table>

<%= periodically_call_remote :url => { :action => 'heartbeat',
                                       :dojo_name => @dojo.name,
                                       :avatar => @avatar.name
                                     }, 
                             :frequency => @dojo.seconds_per_heartbeat -%>
                   

